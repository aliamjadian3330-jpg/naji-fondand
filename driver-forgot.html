<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>فراموشی رمز راننده | ناجی راه</title>

<!-- فونت و آیکون -->
<link href="https://cdn.jsdelivr.net/gh/rastikerdar/vazir-font@v30.1.0/dist/font-face.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/remixicon@3.5.0/fonts/remixicon.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css">

<style>
:root {
  --primary: #ff7a00;
  --primary-dark: #e66c00;
  --success: #4caf50;
  --error: #f44336;
  --radius: 16px;
  --transition: 0.4s ease;
}

body {
  font-family: 'Vazir', sans-serif;
  margin: 0;
  padding: 0;
  min-height: 100vh;
  display: flex;
  justify-content: center;
  align-items: center;
  overflow: hidden;
  background: linear-gradient(135deg, #ff7a00, #ff5500);
  position: relative;
}

body::before, body::after {
  content: '';
  position: absolute;
  width: 200%;
  height: 200%;
  top: -50%;
  left: -50%;
  border-radius: 40%;
  background: radial-gradient(circle at center, rgba(255,255,255,0.1), transparent 70%);
  animation: wave 15s infinite alternate ease-in-out;
  z-index: 0;
}
body::after { animation-delay: 7.5s; }

@keyframes wave {
  0% { transform: rotate(0deg) scale(1); }
  100% { transform: rotate(15deg) scale(1.1); }
}

/* کارت فراموشی رمز */
.auth-card {
  position: relative;
  background: rgba(255,255,255,0.95);
  padding: 45px 35px;
  border-radius: var(--radius);
  box-shadow: 0 15px 35px rgba(0,0,0,0.25);
  max-width: 420px;
  width: 90%;
  backdrop-filter: blur(10px);
  z-index: 1;
  animation: fadeInUp 1s ease;
}
@keyframes fadeInUp { from{opacity:0; transform:translateY(50px);} to{opacity:1; transform:translateY(0);} }

.auth-title { text-align:center; color: var(--primary); font-size:28px; margin-bottom:8px; font-weight:bold; }
.auth-sub { text-align:center; color:#555; margin-bottom:25px; font-size:15px; }

.form-row { margin-bottom:18px; display:flex; flex-direction:column; }
.form-row label { margin-bottom:5px; font-weight:bold; color:#333; }
.form-row input {
  padding:12px 15px;
  border:1px solid #ccc;
  border-radius:12px;
  font-size:15px;
  transition: var(--transition);
}
.form-row input:focus { border-color: var(--primary); box-shadow:0 0 12px rgba(255,122,0,0.5); outline:none; }

.btn {
  padding:12px 20px;
  border:none;
  border-radius:12px;
  cursor:pointer;
  font-weight:bold;
  font-size:15px;
  transition: var(--transition);
  display:flex;
  justify-content:center;
  align-items:center;
  gap:6px;
}
.btn-primary { background: var(--primary); color:#fff; }
.btn-primary:hover { background: var(--primary-dark); transform:scale(1.05); }
.btn-secondary { background:#ddd; color:#333; text-decoration:none; }
.btn-secondary:hover { background:#ccc; transform:scale(1.05); }

.actions { display:flex; justify-content:space-between; flex-wrap:wrap; gap:10px; margin-top:10px; }

.auth-footer { text-align:center; margin-top:20px; color:#555; font-size:14px; }
.auth-footer a { color: var(--primary); font-weight:bold; text-decoration:none; }
.auth-footer a:hover { text-decoration:underline; }

.small { font-size:13px; color:#555; }
@media(max-width:500px){ .actions{ flex-direction:column; } }

/* نوتیفیکیشن زیبا */
.alert-box {
  position: fixed;
  top:20px;
  left:50%;
  transform:translateX(-50%) translateY(-50px);
  min-width:280px;
  max-width:90%;
  background:#fff;
  padding:15px 20px;
  border-radius:16px;
  box-shadow:0 10px 25px rgba(0,0,0,0.2);
  display:flex;
  align-items:center;
  gap:10px;
  font-size:15px;
  opacity:0;
  pointer-events:none;
  z-index:1000;
}
.alert-box.show { opacity:1; transform:translateX(-50%) translateY(0); pointer-events:all; }
.alert-box.success { border-left:6px solid var(--success); }
.alert-box.error { border-left:6px solid var(--error); }
.alert-box i { font-size:22px; }

/* Alert Box بهینه برای موبایل */
.alert-box {
  position: fixed;
  top: 20px;
  left: 50%;
  transform: translateX(-50%) translateY(-60px);
  min-width: 280px;
  max-width: 90%;
  background: #fff;
  padding: 15px 20px;
  border-radius: 16px;
  box-shadow: 0 15px 35px rgba(0,0,0,0.25);
  display: flex;
  align-items: center;
  gap: 12px;
  font-size: 15px;
  opacity: 0;
  pointer-events: none;
  z-index: 1000;
  transition: transform 0.5s ease, opacity 0.5s ease;
}
.alert-box.show {
  opacity: 1;
  transform: translateX(-50%) translateY(0);
  pointer-events: all;
}
.alert-box.success { border-left: 6px solid var(--success); }
.alert-box.error { border-left: 6px solid var(--error); }
.alert-box i {
  font-size: 22px;
  flex-shrink: 0;
}
.alert-box span {
  flex: 1;
  font-weight: 500;
  line-height: 1.4;
  word-break: break-word;
}

/* انیمیشن نرمی برای fade out */
.alert-box.fade-out {
  opacity: 0;
  transform: translateX(-50%) translateY(-60px);
}

/* Shake برای خطا */
.shake {
  animation: shakeX 0.8s ease-in-out;
}
@keyframes shakeX {
  0%, 100% { transform: translateX(0); }
  10%, 30%, 50%, 70%, 90% { transform: translateX(-8px); }
  20%, 40%, 60%, 80% { transform: translateX(8px); }
}
</style>
</head>

<body>
<div class="auth-card">
  <h1 class="auth-title"><i class="ri-lock-unlock-line"></i> فراموشی رمز راننده</h1>
  <p class="auth-sub">لطفاً شماره تماس یا کد ملی خود را وارد کنید</p>

  <form id="forgotForm">
    <div class="form-row">
      <label for="nationalId">کد ملی</label>
      <input type="text" id="nationalId" placeholder="کد ملی راننده" required>
    </div>
    <div class="form-row">
      <label for="phone">شماره تماس</label>
      <input type="tel" id="phone" placeholder="مثال: 0912xxxxxxx" required>
    </div>

    <div class="actions">
      <button type="submit" class="btn btn-primary"><i class="ri-refresh-line"></i> بازیابی رمز عبور</button>
      <a href="driver-login.html" class="btn btn-secondary"><i class="ri-arrow-left-line"></i> بازگشت به ورود</a>
    </div>
  </form>

  <p class="auth-footer">اگر رمز خود را به خاطر دارید، <a href="driver-login.html">اینجا کلیک کنید</a>.</p>
</div>

<!-- Alert Box -->
<!-- Alert Box -->
<div id="alertBox" class="alert-box">
  <i></i><span></span>
</div>

<script>
function showAlert(message,type="success"){
  const box=document.getElementById("alertBox");
  const icon=box.querySelector("i");
  const text=box.querySelector("span");

  box.className=`alert-box ${type} animate__animated`;
  icon.className=type==="success"?"ri-check-line":"ri-error-warning-line";
  text.textContent=message;

  box.classList.add("animate__fadeInDown","show");

  if(type==="error"){
    const card=document.querySelector(".auth-card");
    card.classList.add("animate__animated","animate__shakeX");
    card.addEventListener("animationend",()=>card.classList.remove("animate__animated","animate__shakeX"),{once:true});
  }

  setTimeout(()=>{
    box.classList.remove("animate__fadeInDown");
    box.classList.add("animate__fadeOutUp");
    box.addEventListener("animationend",function handler(){
      box.classList.remove("show","animate__fadeOutUp");
      box.removeEventListener("animationend",handler);
    });
  },3500);
}

document.getElementById("forgotForm").addEventListener("submit",async function(e){
  e.preventDefault();
  const nationalId=document.getElementById("nationalId").value.trim();
  const phone=document.getElementById("phone").value.trim();

  if(!nationalId || !phone){
    showAlert("لطفاً تمام فیلدها را پر کنید.","error");
    return;
  }

  try{
    const res=await fetch('/api/forgot-password',{
      method:'POST',
      headers:{'Content-Type':'application/json'},
      body:JSON.stringify({nationalId,phone})
    });
    const data=await res.json();
    if(res.ok){
      showAlert(data.message || "رمز عبور ارسال شد.","success");
      setTimeout(()=> window.location.href="driver-login.html",1500);
    } else {
      showAlert(data.message || "اطلاعات وارد شده معتبر نیست.","error");
    }
  } catch(err){
    console.error(err);
    showAlert("خطا در اتصال به سرور.","error");
  }
});

function showAlert(message, type="success") {
  const box = document.getElementById("alertBox");
  const icon = box.querySelector("i");
  const text = box.querySelector("span");

  icon.className = type === "success" ? "ri-check-line" : "ri-error-warning-line";
  text.textContent = message;

  box.className = `alert-box ${type} show`;

  // اگر خطا بود shake کارت
  if (type === "error") {
    const card = document.querySelector(".auth-card");
    card.classList.add("shake");
    card.addEventListener("animationend", () => card.classList.remove("shake"), {once:true});
  }

  // بعد از 3.5 ثانیه fade out
  setTimeout(() => {
    box.classList.add("fade-out");
    box.addEventListener("transitionend", function handler() {
      box.className = "alert-box"; // ریست کلاس‌ها
      box.removeEventListener("transitionend", handler);
    });
  }, 3500);
}
</script>
</body>
</html>
