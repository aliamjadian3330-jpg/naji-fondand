<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ورود یدک‌کش | ناجی راه</title>
<link href="https://fonts.googleapis.com/css2?family=Vazir&display=swap" rel="stylesheet">
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css" rel="stylesheet">
<style>
*{margin:0;padding:0;box-sizing:border-box;font-family:'Vazir',sans-serif;}
body{
  min-height:100vh;
  display:flex;
  justify-content:center;
  align-items:center;
  background:#0a4c1b; /* رنگ ثابت و شیک */
  overflow:hidden;
}

/* کارت ورود */
.auth-card{
  position:relative;
  background: rgba(255,255,255,0.08);
  backdrop-filter: blur(20px);
  border-radius: 25px;
  padding:50px 40px;
  width:100%;
  max-width:400px;
  box-shadow:0 20px 50px rgba(0,0,0,0.4);
  border:1px solid rgba(255,255,255,0.2);
  z-index:1;
  animation: cardUp 1s ease forwards;
}
@keyframes cardUp{0%{opacity:0; transform:translateY(80px);}100%{opacity:1; transform:translateY(0);}}

.auth-title{
  text-align:center;
  font-size:2rem;
  font-weight:700;
  color:#fff;
  margin-bottom:10px;
  letter-spacing:1px;
}
.auth-sub{
  text-align:center;
  color:#e0f7e6;
  margin-bottom:30px;
  font-size:1rem;
}

/* فرم */
form{display:flex; flex-direction:column; gap:25px;}
.input-group{position:relative;}
.input-group input{
  width:100%;
  padding:15px 45px 15px 15px;
  border-radius:15px;
  border:1px solid rgba(255,255,255,0.3);
  background: rgba(255,255,255,0.1);
  color:#fff;
  font-size:1rem;
  transition:0.3s;
}
.input-group input::placeholder{color:rgba(255,255,255,0.6);}
.input-group input:focus{
  border-color:#00ff6a;
  box-shadow:0 0 15px rgba(0,255,106,0.6);
  background: rgba(255,255,255,0.15);
  outline:none;
}
.input-group label{
  position:absolute;
  top:50%;
  right:15px;
  transform:translateY(-50%);
  color:#ddd;
  font-size:0.9rem;
  pointer-events:none;
  transition:0.3s;
}
.input-group input:focus + label,
.input-group input:not(:placeholder-shown) + label{
  top:-10px;
  font-size:0.75rem;
  color:#00ff6a;
  font-weight:600;
}
.input-group i{
  position:absolute;
  top:50%;
  left:15px;
  transform:translateY(-50%);
  color:#ddd;
  font-size:18px;
  transition:0.3s;
}
.input-group input:focus ~ i,
.input-group input:not(:placeholder-shown) ~ i{
  color:#00ff6a;
  transform:translateY(-50%) scale(1.2);
}

/* دکمه‌ها */
.actions{display:flex; gap:15px; justify-content:center; margin-top:10px;}
.btn{
  flex:1;
  padding:15px 0;
  border:none;
  border-radius:15px;
  font-weight:700;
  cursor:pointer;
  transition:0.3s;
  font-size:1rem;
}
.btn-primary{
  background: linear-gradient(135deg,#00ff6a,#0a4c1b);
  color:#fff;
  box-shadow:0 6px 20px rgba(0,255,106,0.35);
}
.btn-primary:hover{background: linear-gradient(135deg,#0a4c1b,#00ff6a); transform:scale(1.05);}
.btn-secondary{
  background: rgba(255,255,255,0.25);
  color:#fff;
  border:1px solid rgba(255,255,255,0.4);
  box-shadow:0 4px 15px rgba(0,0,0,0.2);
}
.btn-secondary:hover{background: rgba(255,255,255,0.35); transform:scale(1.05);}

.small{
  font-size:0.9rem;
  color:#fff;
  text-decoration:none;
  display:block;
  text-align:center;
  margin-top:15px;
  transition:0.3s;
}
.small:hover{color:#00ff6a;text-decoration:underline;}

/* پیام موفقیت/خطا */
.alert{
  position: fixed;
  top:20px;
  left:50%;
  transform:translateX(-50%);
  padding:15px 25px;
  border-radius:15px;
  font-weight:500;
  color:#fff;
  opacity:0;
  pointer-events:none;
  z-index:1000;
  transition: all 0.5s ease;
}
.alert.show{opacity:1;pointer-events:auto;animation:slideDown 0.5s;}
.alert.success{background:#4CAF50;}
.alert.error{background:#ff4d4f;}
@keyframes slideDown{0%{transform:translate(-50%,-50px);}100%{transform:translateX(-50%);}}
.shake{animation:shakeX 0.8s ease-in-out;}
@keyframes shakeX{0%,100%{transform:translateX(0);}10%,30%,50%,70%,90%{transform:translateX(-8px);}20%,40%,60%,80%{transform:translateX(8px);}}
@media(max-width:450px){.auth-card{padding:40px 20px;}}
</style>
</head>
<body>

<div class="auth-card">
  <h1 class="auth-title">ورود یدک‌کش</h1>
  <p class="auth-sub">برای دسترسی به حساب کاربری، وارد شوید</p>
  <form id="loginForm">
    <div class="input-group">
      <input type="text" id="nationalId" maxlength="10" placeholder=" ">
      <label>کد ملی</label>
      <i class="fa-solid fa-id-card"></i>
    </div>
    <div class="input-group">
      <input type="password" id="password" placeholder=" ">
      <label>رمز عبور</label>
      <i class="fa-solid fa-lock"></i>
    </div>
    <div class="actions">
      <button type="submit" class="btn btn-primary">ورود</button>
      <a href="tow-signup.html" class="btn btn-secondary">ثبت‌نام یدک‌کش</a>
    </div>
    <a href="tow-forgot.html" class="small">فراموشی رمز عبور؟</a>
  </form>
</div>

<div id="alertBox" class="alert"></div>

<script>
const form = document.getElementById('loginForm');
const alertBox = document.getElementById('alertBox');

function showAlert(message,type='success'){
  alertBox.innerText = message;
  alertBox.className = `alert ${type} show`;
  if(type==='error'){
    document.querySelector('.auth-card').classList.add('shake');
    document.querySelector('.auth-card').addEventListener('animationend',()=>document.querySelector('.auth-card').classList.remove('shake'),{once:true});
  }
  setTimeout(()=>{ alertBox.classList.remove('show'); },3000);
}

form.addEventListener('submit', async (e)=>{
  e.preventDefault();
  const nationalId = document.getElementById('nationalId').value.trim();
  const password = document.getElementById('password').value;

  if(!/^\d{10}$/.test(nationalId)){
    showAlert('کد ملی معتبر نیست!','error'); return;
  }
  if(!password){
    showAlert('رمز عبور وارد نشده!','error'); return;
  }

  try{
    const res = await fetch("https://naji-backend.onrender.com/api/tow/login", {
      method:'POST',
      headers:{'Content-Type':'application/json'},
      body:JSON.stringify({nationalId,password})
    });
    const data = await res.json();
    if(res.ok){
      localStorage.setItem('towUser',JSON.stringify(data.tow));
      showAlert('ورود موفق!','success');
      setTimeout(()=>window.location.href='tow-dashboard.html',1500);
    }else showAlert(data.message || 'خطا در ورود','error');
  }catch(err){console.error(err); showAlert('خطا در اتصال به سرور','error');}
});
</script>

</body>
</html>
